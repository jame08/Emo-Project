<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Mooded Me</title>
    <!- jquery connected ->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="./assets/style.css">
</head>
<body>
    <!- navbar at top->
    <nav class="navbar navbar-light moodedNav">
        <a class="navbar-brand">Mooded</a>
        <!- facebook login button ->
            <div class="fb-login-button" data-max-rows="1" data-size="small" data-button-type="continue_with" data-show-faces="false"
                data-auto-logout-link="true" data-use-continue-as="true"></div>
    </nav>

    <div id="mainContainer">

    </div>


    <div id="fb-root"></div>
    <!- code for the facebook button ->
    <script>(function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.1&appId=257318994871662&autoLogAppEvents=1';
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script> 

    <!- returns unique user id upon signing in->
    <script>
        window.fbAsyncInit = function () {
            FB.init({
                appId: '257318994871662',
                cookie: true,
                xfbml: true,
                version: 'v3.1'
            });

            
            FB.getLoginStatus(function (response) {
                statusChangeCallback(response);
            });

        };

        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) { return; }
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        function statusChangeCallback(response) {
            if (response.status === "connected"){
                console.log("you are logged in!");
                console.log(response)
                console.log(response.authResponse.userID)
                loggedIn(response.authResponse.userID);
            } else {
                console.log("you are not authenticated");
                loggedOut();
            }
        }

        // logged in function
        function loggedIn(userIdentifier) {
            $("#mainContainer").text("you are user number: " + userIdentifier + " and this is the main Div. All the API's and every thing else that is related to you would be displayed here on this div")
        }
        // logged out function
        function loggedOut(){
            $("#mainContainer").text("Please log in to see APIS and information related to you")
        }

        function checkLoginState() {
            FB.getLoginStatus(function (response) {
                statusChangeCallback(response);
            });
        }
    </script>

    <div id="fileUploader">
        <!- the div that holds picture ->
        <progress value="0" max="100" id="uploader">0%</progress>
        <input type="file" value="upload" id="fileButton" />
    </div>

    <!- firebase to store image and other data ->
    <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyCQoXBZAw4SteKOXhCHlWgmRcBJB5wnBkE",
            authDomain: "mooded-6e73b.firebaseapp.com",
            databaseURL: "https://mooded-6e73b.firebaseio.com",
            projectId: "mooded-6e73b",
            storageBucket: "mooded-6e73b.appspot.com",
            messagingSenderId: "207450857045"
        };
        firebase.initializeApp(config);
        // get elements
        var uploader = document.getElementById("uploader");
        var fileButton = document.getElementById("fileButton");

        //  Listen for file selection
        fileButton.addEventListener("change", function(e){

            // Get File
            var file = e.target.files[0];

            // Create a storage ref
            var storageRef = firebase.storage().ref("folder_name/" + file.name);

            // Upload File
            var task = storageRef.put(file);

            // Update progress bar
            task.on("state_changed",
                function progress(snapshot) {
                    var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    uploader.value = percentage;
                },

                function error(err) {

                },

                function complete() {

                    }
                );
        });
   
    </script>

    <div id="testDiv"></div>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>
    
</body>
</html>
