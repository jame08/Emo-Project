!function(){"use strict";var _="https://api-cn.faceplusplus.com/facepp/v3",M="2h9T8RnFQwzMJARrtODAffXD52GQC_WM",j="U6mrLPRuUPYlHsNugS7Oj3s0-ND1A3ye",L="Invalid URL",S="Failed to Load",x="No face detected",C="No camera available";function e(e,t){for(var n=$(e),i=n.find(".photolist"),a=[],r=0,c=t.imgs.length;r<c;r++){var o=document.createElement("img");o.src=t.imgs[r],o.width=o.height=80,a.push(o)}i.append(a);var d=!1;n.find(".left-paddle").click(function(){!1===d&&(d=!0,i.css({left:"-80px"}).prepend(i.children("img:last-child")).animate({left:0},200,"linear",function(){d=!1}))}),n.find(".right-paddle").click(function(){!1===d&&(d=!0,i.animate({left:"-80px"},200,"linear",function(){i.css({left:0}).append(i.children("img:first-child")),d=!1}))});var s=n.find(".canvas").get(0),l=s.getContext("2d"),f=s.width,u=s.height,p=new Image,h=0,g=n.find(".faces");function m(){l.fillStyle="#EEE",l.fillRect(0,0,f,u)}function w(e){var t=n.find(e),i=n.find(".url-field");i.width(t.outerWidth(!0)+i.width()),t.hide()}function v(){g.addClass("loading")}function b(){g.removeClass("loading invalid")}var U=n.find(".rest-url");function R(e){U.text(e)}function y(e,t){if(e!==p.src){var a=++h;v(),m(),g.children().remove(),p.onload=function(){var e=Math.min(f/p.width,u/p.height,1),i={scale:e,width:p.width*e,height:p.height*e,offsetX:(f-p.width*e)/2,offsetY:(u-p.height*e)/2};l.drawImage(p,i.offsetX,i.offsetY,i.width,i.height),function(e){if($.support.cors){var t=new XMLHttpRequest;t.timeout=1e4,t.onreadystatechange=function(){4===t.readyState&&(200===t.status?e.success(JSON.parse(t.responseText)):e.error())};var i=new FormData;i.append("api_key",M),i.append("api_secret",j),i.append("return_landmark",1),i.append("return_attributes","gender,age,headpose"),"dataURI"===e.type?(t.open("POST",_+"/detect"),i.append("image_file",function(e){for(var t=atob(e.split(",")[1]),i=[],a=0;a<t.length;a++)i.push(t.charCodeAt(a));return new Blob([new Uint8Array(i)],{type:"image/jpeg"})}(e.img)),t.send(i)):"url"===e.type?(t.open("POST",_+"/detect"),i.append("image_url",e.img),t.send(i)):e.error()}else"url"===e.type?$.ajax({url:_+"/detect",data:{api_key:M,api_secret:j,url:e.img},dataType:"jsonp",success:e.success,error:e.error,timeout:1e4}):e.error()}({img:p.src,type:t?"dataURI":"url",success:function(e){if(a===h){R(_+"/detect");var t=JSON.stringify(e,null,"  ");try{Rainbow.color(t,"javascript",function(e){n.find(".result").html(e)})}catch(e){n.find(".result").text(t)}!function(e,t){if(v(),0===t.length)R(x);else for(var i=t.length-1;0<=i;i--){var a,n,r=t[i];"Male"===r.attributes.gender.value?(a="#12BDDC",n="rgba(0,255,0,0.8)"):(a="#FE007F",n="rgba(255,0,0,0.8)");var c=e.scale,o=r.attributes.headpose.roll_angle;$("<div/>").css({position:"absolute",top:e.offsetY+r.face_rectangle.top*c-5,left:e.offsetX+r.face_rectangle.left*c-5,width:r.face_rectangle.width*c,height:r.face_rectangle.height*c,border:"2px solid "+a,borderColor:n,borderRadius:"2px",transform:"rotate("+o+"deg)"}).appendTo(g)}b()}(i,e.faces)}},error:function(){a===h&&(m(),b(),R(S))}})},p.onerror=function(){m(),b(),g.addClass("invalid"),n.find(".result").html(""),R(L)},p.src=e}}if(n.find(".url-field").focus(function(){$(this).select()}).mouseup(function(){return!1}),n.find(".url-form").on("submit",function(){return y($(this).children(".url-field").val()),!1}),i.children("img").click(function(){n.find(".url-field").val(this.src),y(this.src)}),navigator.getUserMedia){var k=n.find(".webcam");k&&k.click(function(){return $(".camera-modal").show(),navigator.getUserMedia({video:!0,audio:!1},function(e){var i=$(".camera-modal video").get(0),t=n.find(".camera-modal"),a=function(){$(i).hide(),e.stop(),t.hide(),n.find(".capture").hide(),t.unbind("click")};t.click(a),i.src=window.URL.createObjectURL(e),i.onerror=function(){e.stop(),a()},$([n.find(".capture").get(0),i]).show().unbind("click").click(function(){v();var e=Math.min(f/i.videoWidth,u/i.videoHeight,1),t=document.createElement("canvas");return t.height=i.videoHeight*e,t.width=i.videoWidth*e,t.getContext("2d").drawImage(i,0,0,i.videoWidth*e,i.videoHeight*e),y(t.toDataURL("image/jpeg"),!0),a(),!1})},function(){$(".camera-modal").hide(),R(C),w(".webcam")}),!1})}else w(".webcam");window.FileReader?n.find(".upload-file").change(function(){if(0<this.files.length){v();var e=new FileReader;e.onload=function(){y(e.result,!0)},e.onerror=function(){b(),g.addClass("invalid")},e.readAsDataURL(this.files[0])}}):w(".upload-file-wrapper"),m(),i.children("img:first-child").click()}window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,$(function(){e(document.getElementById("detector"),{imgs:["https://www.faceplusplus.com.cn/scripts/demoScript/images/demo-pic1.jpg","https://www.faceplusplus.com.cn/scripts/demoScript/images/demo-pic10.jpg","https://www.faceplusplus.com.cn/scripts/demoScript/images/demo-pic8.jpg","https://www.faceplusplus.com.cn/scripts/demoScript/images/demo-pic6.jpg"]})})}();